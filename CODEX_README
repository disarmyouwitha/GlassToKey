# CODEX_README

Scratchpad for future Codex runs in this repo.

## Current focus
- Multi-touchpad support (2 devices at once) across Objective-C and Swift layers.
- Device identification: per-event deviceID, per-touch deviceID, and ability to select active devices.
- Demo UI updated to pick left/right trackpads and render both simultaneously.

## What was changed (multi-device PR)
- Objective-C framework now tracks multiple MTDeviceRef entries, maps them to device IDs, and emits deviceID per event.
- Swift wrapper surfaces availableDevices/activeDevices, setActiveDevices, and deviceID on OMSTouchData.
- Demo app shows two selectors and two canvases; filtering touches by deviceID.

## Key files and responsibilities
- Framework/OpenMultitouchSupportXCF/OpenMTManager.h
  - Public API for device listing/selection and haptics.
- Framework/OpenMultitouchSupportXCF/OpenMTManager.m
  - Enumerates devices, stores device refs by ID, handles multi-device callbacks.
  - contactEventHandler now sets event.deviceID via deviceIDForDeviceRef.
  - setActiveDevices updates active devices and restarts MTDevice callbacks if needed.
- Framework/OpenMultitouchSupportXCF/OpenMTEvent.h/.m/.internal
  - Adds deviceID to event payload.
- Sources/OpenMultitouchSupport/OMSManager.swift
  - Swift API surfaces availableDevices, activeDevices, setActiveDevices.
  - listen(_:) maps event.deviceID into OMSTouchData.
- Sources/OpenMultitouchSupport/OMSTouchData.swift
  - deviceID added to touch data.
- Demo/OMSDemo/ContentView.swift
  - Two pickers (left/right) and two trackpad canvases.
- Demo/OMSDemo/ContentViewModel.swift
  - Filters touches per deviceID and tracks active touches with (deviceID, touchID) key.
  - Includes haptic toggles and raw haptic test controls.
- README.md
  - Updated usage to show device selection and deviceID in touch data.
- Package.swift
  - Updated to point at v1.1.0 release for XCFramework.

## How multi-device works (quick notes)
- On startup, OpenMTManager enumerates MT devices, builds OpenMTDeviceInfo entries (deviceName/deviceID/isBuiltIn).
- setActiveDevices stores an array of selected device infos and refreshes MTDeviceRef map.
- When listening, each MTDeviceRef registers a contact callback; callback sets event.deviceID from device ref.
- Swift layer passes deviceID into OMSTouchData so UI can split left/right streams.

## Haptics notes
- Raw haptic support is exposed via OpenMTManager triggerRawHaptic and OMSManager wrapper.
- Demo includes safety toggles and a raw haptic testing UI.
- Haptic safety: demo restores haptics on hover/exit, app background, and termination.

## Repo workflow reminders
- Swift wrapper edits: edit `Sources/OpenMultitouchSupport/`, commit/push.
- Framework edits: edit `Framework/OpenMultitouchSupportXCF/`, run `./build_framework.sh`, then `./release.sh <version>`, then update `Package.swift`.

## TODO
- (Intentionally left blank; fill this right before switching contexts.)

## Last commit context
- Merge of multi-device PR (multi-device trackpad support). See commit fe9f6ac on main.
- The PR range between merge parents shows the multi-device file set listed above.
